<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
   xmlns:ui="http://java.sun.com/jsf/facelets"
   xmlns:f="http://java.sun.com/jsf/core"
   xmlns:h="http://java.sun.com/jsf/html"
   xmlns:p="http://primefaces.org/ui"
   template="/WEB-INF/templates/default.xhtml">
   
   <ui:define name="content">
   
   
   <style>
   	.itemReceita{
   		color: blue;
   		background-color: #FFFAF0;
   		border-bottom: 1px solid blank;
   		margin-top: 1px;
   		margin-bottom: 1px; 
   		min-height: 25px;
   		vertical-align: middle;
   	}
   	
   	.itemDespesa{
   		color: red;
   		background-color: #FFFAF0;
   		border-bottom: 1px solid blank;
   		margin-top: 1px;
   		margin-bottom: 1px; 
   		min-height: 25px;
   		vertical-align: middle;
   	}
 
 .ui-autocomplete-input{width: 100%;}
   </style>
   
   	<h:form id="form" style="width:100%">
   	
   		<p:remoteCommand id="atualizarConf" name="atualizarConf" 
   				actionListener="#{lancarBalancoController.montarBalanco()}" immediate="true" 
   				update="panelInfoItem, containerItens"></p:remoteCommand>
   				
   	
   		<h1>Lançamento de receitas e despesas</h1>
	 	<p:outputLabel styleClass="textoInformativo" 
	   			value="Cadastre as receitas e despesas do condomínio. Se desejar anexe o comprovante de cada lançamento. Torne a prestação de contas do condomínio mais transparente!" />
	 	<br />
	 	
	 	<br />
	 	
	 	<p:outputPanel id="containerCompetencia">
		 	<p:outputLabel value="Qual a competência?"  styleClass="labelPadraoInline"/>
		 	
		 	<span>
	 			<p:selectOneMenu id="anoRef" styleClass="inputPadrao" required="true" 
			 			requiredMessage="Favor selecionar o ano de refência" immediate="true" 
						value="#{lancarBalancoController.ano}"  >
					<p:ajax event="change" oncomplete="atualizarConf()" process="@this" />
			 		<f:selectItems value="#{lancarBalancoController.anos}"
			 			var="entry" itemValue="#{entry}" itemLabel="#{entry}" />
			 	</p:selectOneMenu>
			</span>	
	 		<p:outputLabel value=" / " styleClass="labelPadraoInline" /> 
		 	<span>
			 	<p:selectOneMenu id="mesRef" styleClass="inputPadrao" required="true" 
			 			requiredMessage="Favor selecionar o mês de refência" immediate="true" 
						value="#{lancarBalancoController.mes}"  >
					<p:ajax event="change" oncomplete="atualizarConf()" process="@this" />
			 		<f:selectItems value="#{lancarBalancoController.meses.entrySet()}"
			 			var="entry" itemValue="#{entry.key}" itemLabel="#{entry.value}" />
			 	</p:selectOneMenu>
			</span>
		</p:outputPanel>
		
	 	<br />
	 	
	 	<p:outputPanel id="panelInfoItem" >
		 	<p:outputLabel value="Você deseja lançar uma " styleClass="labelPadraoInline" />
		 	<p:selectOneButton value="#{lancarBalancoController.tipoBalanco}" 
		 			valueChangeListener="#{lancarBalancoController.carregarDescricoesAutoCompletar(null)}">
	            <f:selectItem itemLabel="Receita" itemValue="RECEITA" />
	            <f:selectItem itemLabel="Despesa" itemValue="DESPESA" />
	        </p:selectOneButton>
	        
	        <br /><br />
	        
			<div >
				<p:outputLabel for="valorItem" value="Valor: R$" styleClass="labelPadrao"  />
				<p:inputText id="valorItem" styleClass="inputPadrao"  style="width:100px" 
						required="true" requiredMessage="O campo valor é obrigatório."
						value="#{lancarBalancoController.valor}" maxlength="10"  >
							<f:convertNumber pattern="#0.00"/>
				</p:inputText> 
			</div>
	        <div >		 	
			 	<p:outputLabel for="descItem" value="Descrição:" styleClass="labelPadrao" /><br />
			 	<p:autoComplete id="descItem"   styleClass="inputPadraoAutocompleteTxt"
			 			 value="#{lancarBalancoController.descricao}" maxlength="100" 
			 			  required="true" requiredMessage="O campo descrição é obrigatório."  
			 			completeMethod="#{lancarBalancoController.completeText}" />
				
			</div>
			
			<p:outputPanel id="painelArquivo" style="position:relative; diplay:block; margin-top:10px; " layout="block" >
		       
		        <p:fileUpload rendered="#{lancarBalancoController.arqBalanco == null}"
				        mode="advanced" update="painelArquivo" label="Anexar comprovante"
				        fileUploadListener="#{lancarBalancoController.uploadArquivo}"
				        allowTypes="/(\.|\/)(pdf|PDF|doc|DOC|docx|DOCX|xlsx|xls|XLSX|XLS|txt|PNG|png|jpg|JPG)$/" 
				        invalidFileMessage="Tipo do arquivo inválido"
				        invalidSizeMessage="Tamanho do arquivo inválido"
				        multiple="false" sizeLimit="100000000" fileLimitMessage="O arquivo é muito grande. " 
				        auto="true" dragDropSupport="false" />
				<br />
				<p:outputPanel rendered="#{lancarBalancoController.arqBalanco != null}" style="width:85%; height:30px; background-color:#CED8F6;">
					<p:outputLabel value="Arquivo anexado: "/> <p:outputLabel value="#{lancarBalancoController.arqBalanco.nomeOriginal}"></p:outputLabel>
					<p:commandButton id="removerArq" value="Remover" immediate="true" style="margin-left:10px; float:right;"
				   		actionListener="#{lancarBalancoController.removerArquivo}" 
				   		update="painelArquivo">
				   	</p:commandButton>
				</p:outputPanel>
			</p:outputPanel>
		
			<div style="width:100%; text-align: center; margin:5px; height: 30px;">
				<p:commandButton id="btnSalvar" value="Salvar"  update="panelInfoItem, containerItens"
					styleClass="botao"
			   		actionListener="#{lancarBalancoController.salvarItemBanlanco}"  >
		   		</p:commandButton>
		   		
		   		<p:commandButton id="btnLimpar" value="Limpar"  update="panelInfoItem"
		   			styleClass="botao"
			   		actionListener="#{lancarBalancoController.limparDadosItem()}"  >
		   		</p:commandButton>
	   		</div>
		</p:outputPanel>				 	
	 
	 	
	 	<p:outputPanel id="containerItens" style="margin-top:50px;">
	 	
	 	<table style="width: 100%">
	 	<tr>
	 		<td style="width: 50%; padding: 5px; ">
	 			<p:dataList value="#{lancarBalancoController.receitas}" var="receita"  style="top:0px;"
	 				type="ordered" emptyMessage="Nenhuma receita lançada" itemStyleClass="itemReceita" >
			        <f:facet name="header">
			            Receitas
			        </f:facet>
			        
			        <f:facet name="footer" >
			        	<p:outputLabel style="color:blue" value="Total: " /> <p:outputLabel style="color:blue" value="#{lancarBalancoController.balanco.totalReceitas}"><f:convertNumber pattern="#0.00" /></p:outputLabel>
			        </f:facet>
			        
			        <div style="width: 65%; float: left;">
			        	#{receita.descricao}
			        </div>
			        <div style="width: 25%; float: left; text-align: right;">
			        	R$ #{receita.valor}
			        </div>
			        <div style="width: 10%; float: left; text-align: center;">
			        	<p:commandLink actionListener="#{lancarBalancoController.removerItemBanlanco(receita)}" 
			         		id="removerReceita" immediate="true" update=":form:containerItens" >
			         		<p:graphicImage id="imgRemoverReceita" url="/img/icones/ico_remover.png" 
				     				title="Clique para remover a receita." />
				     		<p:confirm header="Confirmação" message="Tem certeza que deseja remover essa receita?" icon="ui-icon-alert" />
	         			</p:commandLink>
			        </div>
			    </p:dataList>
	 		</td>
	 		
	 		<td style="width: 50%; padding: 5px; ">
	 			
	 			<p:dataList value="#{lancarBalancoController.despesas}" var="despesa"   style="top:0px;"
	 				type="ordered" emptyMessage="Nenhuma despesa lançada" itemStyleClass="itemDespesa">
			        <f:facet name="header">
			            Despesas
			        </f:facet>
			        
			        <f:facet name="footer">
			        	<p:outputLabel style="color:red" value="Total: " /> <p:outputLabel style="color:red" value="#{lancarBalancoController.balanco.totalDespesas}"><f:convertNumber pattern="#0.00" /></p:outputLabel>
			        </f:facet>
			        
			        <div style="width: 65%; float: left;">
			        	#{despesa.descricao}
			        </div>
			        <div style="width: 25%; float: left; text-align: right;">
			        	R$ #{despesa.valor}
			        </div>
			        <div style="width: 10%; float: left; text-align: center;">
			           	<p:commandLink actionListener="#{lancarBalancoController.removerItemBanlanco(despesa)}" 
			         		id="removerDespesa" immediate="true" update=":form:containerItens" >
			         		<p:graphicImage id="imgRemoverDespesa" url="/img/icones/ico_remover.png" 
				     				title="Clique para remover o item da despesa." />
				     		<p:confirm header="Confirmação" message="Tem certeza que deseja remover essa despesa?" icon="ui-icon-alert" />
	         			</p:commandLink>
			        </div>
			    </p:dataList>
	 		</td>
	 	</tr>
	 	</table>
	 	
	 	</p:outputPanel>
	   	
		
		<p:confirmDialog global="true" showEffect="fade" hideEffect="fade"  >
	        <p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
	        <p:commandButton value="Não" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
	    </p:confirmDialog>    
			    
	 </h:form>
	 
  </ui:define>
</ui:composition>
