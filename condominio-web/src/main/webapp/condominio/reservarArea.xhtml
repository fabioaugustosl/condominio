<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
   xmlns:ui="http://java.sun.com/jsf/facelets"
   xmlns:f="http://java.sun.com/jsf/core"
   xmlns:h="http://java.sun.com/jsf/html"
   xmlns:p="http://primefaces.org/ui"
   template="/WEB-INF/templates/default.xhtml">
   
   <ui:define name="content">
   	<h:form id="form" style="width:100%">
	   	<h1><p:outputLabel value="Reservar área em comum" /></h1>
	 	<br /><br />
	 	<p:outputLabel value="Selecione a área desejada: " />
	 	<p:selectOneMenu id="comboArea" value="#{reservaController.areaSelecionada}" converter="converterEntityById" >
	 		<f:selectItem itemLabel="Selecione ..." itemValue="" />
	 		<f:selectItems value="#{reservaController.areas}" var="area" itemLabel="#{area.nome}" itemValue="#{area}" />
	 		<p:ajax event="change" update="containerAgenda" listener="#{reservaController.recuperarEventos}" />
	 	</p:selectOneMenu>
	 	
	 	<p:outputPanel id="containerAgenda" style="margin-top:10px;">
	  		<p:schedule id="agendaReserva" value="#{reservaController.reservas}" widgetVar="agendaReserva" timeZone="GMT-3" locale="pt" >
	            <p:ajax event="dateSelect" listener="#{reservaController.onDateSelect}" update="novoEventoPanelContainer" onsuccess="PF('novoEvento').show();" />
	            <p:ajax event="eventSelect" listener="#{reservaController.onEventSelect}" update="removerEventoPanelContainer" oncomplete="PF('removerEvento').show();" />
	        </p:schedule>
	    </p:outputPanel> 
	    
	    <p:outputPanel id="containerMaximoDia" rendered="#{reservaController.maximoDiasFuturo > 0}">
	    	<p:outputLabel value="Data máxima para agendamento: "  />
	    	<p:outputLabel value="#{reservaController.dataMaximaAgendamento}"  >
	    		<f:convertDateTime pattern="dd/MM/yyyy"/>
	    	</p:outputLabel>
	    	
	    </p:outputPanel>
	    
	    <p:dialog id="novoEvento" widgetVar="novoEvento" header="Agendar" showEffect="fade" hideEffect="fade" dynamic="false" appendTo="@(body)" >
		    <p:outputPanel id="novoEventoPanelContainer" >
		        <p:outputPanel id="novoEventoPanel" rendered="#{reservaController.areaSelecionada != null}" >
		            
		            <p:outputLabel value="#{reservaController.mensagemConfirmacaoReserva}" id="txtMsgConfirmacao"  />
		 			
		 			<p:outputPanel>
			            <p:commandButton id="btnAgendar"  process="@this"  value="Sim" actionListener="#{reservaController.salvarReserva}" immediate="true"
			            	 update="@form" oncomplete="PF('novoEvento').hide();"  />
			            <p:commandButton id="btnAgendarNao" value="Não" onclick="PF('novoEvento').hide();" />
		            </p:outputPanel>
		        </p:outputPanel>
		        <p:outputPanel id="eventoErro" rendered="#{reservaController.areaSelecionada == null}"  >
		            
		            <p:outputLabel value="Favor selecionar uma área para efetuar a reserva." id="txtMsgErro" />
		 			<br />
		            <p:commandButton id="btnAgendarOK" value="OK" onclick="PF('novoEvento').hide();" />
		        </p:outputPanel>
	        </p:outputPanel>
	    </p:dialog>  
	    
	     <p:dialog id="removerEvento" widgetVar="removerEvento" header="Remover agendamento" showEffect="fade" hideEffect="fade" dynamic="false" appendTo="@(body)" >
			<p:outputPanel id="removerEventoPanelContainer" >
		        <p:outputPanel id="removerEventoPanel" rendered="#{reservaController.podeRemoverReserva}" >
		            
		            <p:outputLabel value="#{reservaController.mensagemExclusaoReserva}" id="txtMsgRemoverReserva"  />
		 			
		 			<p:outputPanel>
		             	<p:commandButton id="btnRemoverAgendaSim"  process="@this"  value="Sim" actionListener="#{reservaController.removerReserva}" immediate="true"
			            	 update="@form" oncomplete="PF('removerEvento').hide();"  />
			            	
					 	<p:commandButton id="btnRemoverNao" value="Não" onclick="PF('removerEvento').hide();" />
		            </p:outputPanel>
		        </p:outputPanel>
		        <p:outputPanel id="eventoErro" rendered="#{!reservaController.podeRemoverReserva}"  >
		            
		            <p:outputLabel value="Você não tem permissão para remover essa reserva." id="txtMsgErro" />
		 			<br />
		            <p:commandButton id="btnFecharRemReser" value="OK" onclick="PF('removerEvento').hide();" />
		        </p:outputPanel>
	        </p:outputPanel>
	    </p:dialog>    
	    
	   
	    <script type="text/javascript">
		    PrimeFaces.locales['pt'] = {
		        closeText: 'Fechar',
		        prevText: 'Anterior',
		        nextText: 'Próximo',
		        currentText: 'Hoje',
		        monthNames: ['Janeiro','Fevereiro','Março','Abril','Maio','Junho',
		            'Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'],
		        monthNamesShort: ['Jan','Fev','Mar','Abr','Mai','Jun',
		            'Jul','Ago','Set','Out','Nov','Dez'],
		        dayNames: ['Domingo','Segunda','Terça','Quarta','Quinta','Sexta','Sábado'],
		        dayNamesShort: ['Dom','Seg','Ter','Qua','Qui','Sex','Sab'],
		        dayNamesMin: ['Dom','Seg','Ter','Qua','Qui','Sex','Sab'],
		        weekHeader: 'Hf',
		        firstDay: 1,
		        isRTL: false,
		        showMonthAfterYear: false,
		        yearSuffix: '',
		        month: 'Mês',
		        week: 'Semana',
		        day: 'Dia',
		        allDayText : 'Hora'
		    };
		</script>
		<style type="text/css">
		    .value {
		        width: 1000px;
		    }
		</style>
	</h:form>
   </ui:define>
</ui:composition>
